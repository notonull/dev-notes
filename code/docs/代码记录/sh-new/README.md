# Docker Compose éƒ¨ç½²è„šæœ¬ç³»ç»Ÿ

è¿™æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„DockeræœåŠ¡éƒ¨ç½²è„šæœ¬ç³»ç»Ÿï¼Œæ”¯æŒç»Ÿä¸€ç®¡ç†å¤šä¸ªDockeræœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸã€‚

## ç›®å½•ç»“æ„

```
.
â”œâ”€â”€ docker-compose-deploy.sh    # ä¸»è„šæœ¬ (v2.0)
â”œâ”€â”€ deploy/                     # å­è„šæœ¬ç›®å½•
â”‚   â””â”€â”€ jenkins.sh             # JenkinsæœåŠ¡éƒ¨ç½²è„šæœ¬ (v2.0)
â”œâ”€â”€ lib/                        # ğŸ†• å…¬å…±åº“ç›®å½•
â”‚   â”œâ”€â”€ logger.sh              # æ—¥å¿—å·¥å…·åº“
â”‚   â”œâ”€â”€ docker_utils.sh        # Dockeræ“ä½œåº“
â”‚   â”œâ”€â”€ system_utils.sh        # ç³»ç»Ÿå·¥å…·åº“
â”‚   â””â”€â”€ config_utils.sh        # é…ç½®ç®¡ç†åº“
â”œâ”€â”€ README.md                  # è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ USAGE_EXAMPLES.md          # ä½¿ç”¨ç¤ºä¾‹
â””â”€â”€ DEMO.md                    # é‡æ„æ¼”ç¤ºæ–‡æ¡£
```

## åŠŸèƒ½ç‰¹æ€§

### ä¸»è„šæœ¬åŠŸèƒ½
- **ç»Ÿä¸€ç®¡ç†**: é€šè¿‡ä¸»è„šæœ¬ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å­æœåŠ¡è„šæœ¬
- **æ‰¹é‡æ“ä½œ**: æ”¯æŒå¯¹æ‰€æœ‰æœåŠ¡æ‰§è¡Œæ‰¹é‡æ“ä½œ
- **å®‰å…¨ç¡®è®¤**: å±é™©æ“ä½œéœ€è¦ç”¨æˆ·ç¡®è®¤
- **æ¨¡å—åŒ–è®¾è®¡**: å­è„šæœ¬å¯ç‹¬ç«‹è¿è¡Œ
- **æ—¥å¿—ç³»ç»Ÿ**: ç»Ÿä¸€çš„å½©è‰²æ—¥å¿—è¾“å‡º

### å­è„šæœ¬åŠŸèƒ½
- **æ ‡å‡†åŒ–é…ç½®**: ç»Ÿä¸€çš„å˜é‡å‘½åè§„èŒƒ
- **å®Œæ•´ç”Ÿå‘½å‘¨æœŸ**: æ”¯æŒæœåŠ¡çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **çŠ¶æ€æ£€æŸ¥**: å®æ—¶è·å–æœåŠ¡çŠ¶æ€
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯æ£€æŸ¥å’Œå¤„ç†

## ä½¿ç”¨æ–¹æ³•

### ä¸»è„šæœ¬å‘½ä»¤

```bash
# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
./docker-compose-deploy.sh help

# æŸ¥çœ‹é…ç½®ä¿¡æ¯
./docker-compose-deploy.sh config           # æ‰€æœ‰æœåŠ¡
./docker-compose-deploy.sh config jenkins   # æŒ‡å®šæœåŠ¡

# æ‹‰å–é•œåƒ (éœ€è¦ç¡®è®¤)
./docker-compose-deploy.sh pull             # æ‰€æœ‰æœåŠ¡
./docker-compose-deploy.sh pull jenkins     # æŒ‡å®šæœåŠ¡

# å®‰è£…æœåŠ¡ (éœ€è¦ç¡®è®¤)
./docker-compose-deploy.sh install          # æ‰€æœ‰æœåŠ¡
./docker-compose-deploy.sh install jenkins  # æŒ‡å®šæœåŠ¡

# å¯åŠ¨æœåŠ¡ (éœ€è¦ç¡®è®¤)
./docker-compose-deploy.sh up               # æ‰€æœ‰æœåŠ¡
./docker-compose-deploy.sh up jenkins       # æŒ‡å®šæœåŠ¡

# åœæ­¢æœåŠ¡ (éœ€è¦ç¡®è®¤)
./docker-compose-deploy.sh down             # æ‰€æœ‰æœåŠ¡
./docker-compose-deploy.sh down jenkins     # æŒ‡å®šæœåŠ¡

# å¸è½½æœåŠ¡ (éœ€è¦ç¡®è®¤)
./docker-compose-deploy.sh uninstall        # æ‰€æœ‰æœåŠ¡
./docker-compose-deploy.sh uninstall jenkins # æŒ‡å®šæœåŠ¡

# åˆ é™¤é•œåƒ (éœ€è¦ç¡®è®¤)
./docker-compose-deploy.sh rmi              # æ‰€æœ‰æœåŠ¡
./docker-compose-deploy.sh rmi jenkins      # æŒ‡å®šæœåŠ¡

# æŸ¥çœ‹æ—¥å¿— (å¿…é¡»æŒ‡å®šæœåŠ¡)
./docker-compose-deploy.sh logs jenkins

# æŸ¥çœ‹æœåŠ¡ä¿¡æ¯
./docker-compose-deploy.sh info             # æ‰€æœ‰æœåŠ¡
./docker-compose-deploy.sh info jenkins     # æŒ‡å®šæœåŠ¡
```

### å­è„šæœ¬ç‹¬ç«‹ä½¿ç”¨

```bash
# å¯ä»¥ç›´æ¥è¿è¡Œå­è„šæœ¬
./deploy/jenkins.sh install
./deploy/jenkins.sh info
./deploy/jenkins.sh logs
```

## é…ç½®è¯´æ˜

### å˜é‡å‘½åè§„èŒƒ

#### åŸºç¡€å˜é‡ (base_ å‰ç¼€)
- `base_image_name`: Dockeré•œåƒåç§°
- `base_container_name`: å®¹å™¨åç§°
- `base_install_path`: å®‰è£…è·¯å¾„
- `base_ip`: æœåŠ¡å™¨IPåœ°å€

#### ç¯å¢ƒå˜é‡ (env_ å‰ç¼€)
- `env_ports`: ç«¯å£æ˜ å°„æ•°ç»„
- `env_volumes`: å·æŒ‚è½½æ•°ç»„
- `env_environment`: ç¯å¢ƒå˜é‡æ•°ç»„

### æ—¥å¿—ç³»ç»Ÿ

æä¾›ç»Ÿä¸€çš„æ—¥å¿—å‡½æ•°ï¼š
- `log_info`: ä¿¡æ¯æ—¥å¿— (ç»¿è‰²)
- `log_warn`: è­¦å‘Šæ—¥å¿— (é»„è‰²)
- `log_error`: é”™è¯¯æ—¥å¿— (çº¢è‰²)
- `log_step`: æ­¥éª¤æ—¥å¿— (è“è‰²)

### æœåŠ¡çŠ¶æ€

- **è¿è¡Œä¸­** (ç»¿è‰²): å®¹å™¨æ­£åœ¨è¿è¡Œ
- **å·²åœæ­¢** (é»„è‰²): å®¹å™¨å·²åœæ­¢
- **æœªå®‰è£…** (çº¢è‰²): æœåŠ¡æœªå®‰è£…
- **æœªçŸ¥çŠ¶æ€** (çº¢è‰²): æ— æ³•ç¡®å®šçŠ¶æ€

## Jenkins æœåŠ¡è¯´æ˜

### é»˜è®¤é…ç½®
- **é•œåƒ**: jenkins/jenkins:lts
- **ç«¯å£**: 8080 (Webç•Œé¢), 50000 (JNLP)
- **æ•°æ®ç›®å½•**: /opt/server/jenkins/data
- **æ—¥å¿—ç›®å½•**: /opt/server/jenkins/logs
- **æ—¶åŒº**: Asia/Shanghai

### å®‰è£…åæ“ä½œ
1. è®¿é—® http://æ‚¨çš„IP:8080/
2. ä½¿ç”¨æ˜¾ç¤ºçš„åˆå§‹ç®¡ç†å‘˜å¯†ç è¿›è¡Œåˆå§‹åŒ–
3. å®‰è£…æ¨èçš„æ’ä»¶
4. åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·

## æ‰©å±•æ–°æœåŠ¡

### 1. åˆ›å»ºå­è„šæœ¬
åœ¨ `deploy/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æœåŠ¡è„šæœ¬ï¼Œä¾‹å¦‚ `deploy/nginx.sh`

### 2. æ³¨å†ŒæœåŠ¡
åœ¨ä¸»è„šæœ¬çš„ `REGISTERED_SCRIPTS` ä¸­æ·»åŠ æ˜ å°„ï¼š
```bash
REGISTERED_SCRIPTS["nginx"]="deploy/nginx.sh"
```

### 3. å®ç°æ ‡å‡†å‡½æ•°
å­è„šæœ¬éœ€è¦å®ç°ä»¥ä¸‹å‡½æ•°ï¼š
- `cmd_config`: æ˜¾ç¤ºé…ç½®
- `cmd_pull`: æ‹‰å–é•œåƒ
- `cmd_install`: å®‰è£…æœåŠ¡
- `cmd_uninstall`: å¸è½½æœåŠ¡
- `cmd_down`: åœæ­¢æœåŠ¡
- `cmd_up`: å¯åŠ¨æœåŠ¡
- `cmd_rmi`: åˆ é™¤é•œåƒ
- `cmd_logs`: æŸ¥çœ‹æ—¥å¿—
- `cmd_info`: æ˜¾ç¤ºä¿¡æ¯
- `cmd_help`: æ˜¾ç¤ºå¸®åŠ©

## ç³»ç»Ÿè¦æ±‚

- Linux/Unix ç³»ç»Ÿ
- Bash 4.0+
- Docker
- Docker Compose

## æ³¨æ„äº‹é¡¹

1. æ‰¹é‡æ“ä½œæ—¶ä¼šè¦æ±‚ç”¨æˆ·ç¡®è®¤ï¼Œç¡®ä¿å®‰å…¨æ€§
2. å­è„šæœ¬å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–ä¸»è„šæœ¬
3. æ‰€æœ‰å±é™©æ“ä½œéƒ½æœ‰ç¡®è®¤æç¤º
4. æ—¥å¿—ä¼šæ˜¾ç¤ºæ—¶é—´æˆ³å’Œå½©è‰²æ ‡è¯†
5. æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡è‡ªå®šä¹‰é…ç½®

## æ•…éšœæ’é™¤

### æƒé™é—®é¢˜
```bash
chmod +x docker-compose-deploy.sh
chmod +x deploy/*.sh
```

### Dockeræƒé™é—®é¢˜
```bash
sudo usermod -aG docker $USER
# é‡æ–°ç™»å½•æˆ–æ‰§è¡Œ
newgrp docker
```

### æœåŠ¡ç«¯å£å†²çª
æ£€æŸ¥å¹¶ä¿®æ”¹å­è„šæœ¬ä¸­çš„ç«¯å£é…ç½®ï¼Œæˆ–åœæ­¢å†²çªçš„æœåŠ¡ã€‚